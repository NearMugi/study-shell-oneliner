# 第1章Linux環境 1.5 もっとawkとsedに慣れる

## P43 問題5 設定ファイルからの情報抽出

```bash
FILE="../shellgei160/qdata/5/ntp.conf"
cat ${FILE} | awk '$1=="pool"' | awk '{print $2}'
```

## P44 問題6 端末に模様を描く

```bash
# 以下を出力する
#    X
#   X
#  X
# X
#X

seq 5 | awk '{for(i=1;i<$1;i++){printf " "}; print "X"}' | tac
# seq 5 | awk '{for(i=1;i<$1;i++){printf " "}; print "X"}' で seq のサイズ分だけ空白を入れてXを出力する
# tac で出力順を逆にする

seq 5 -1 1| awk '{for(i=1;i<$1;i++){printf " "}; print "X"}'
# seq の値を上から減らしていくパターン
# tac が不要になる

seq 5 | awk '{a++; for(i=5;i>a;i--){printf " "};print "X"}'
# seq の値を 変数a に入れて空白を出力

seq 5 | awk '{for(i=5;i>NR;i--){printf " "};print "X"}'
# 行番号が入るawkの 変数NR を使う
# 1,2,3,4,5 となる

printf "%*s\n" 5 X 4 X 3 X 2 X 1 X
# printf "%5s\n" X は 文字列の長さを5に指定している
# printf "%*s\n" 5 X は 文字列の長さを引数にして渡している
# printf "%5s\n" X YY ZZZ は "%5s\n" を連続適用する
#    X
#   YY
#  ZZZ

seq 5 -1 1 | awk '{printf "%*s\n",$1,"X"}'
# 上記と同義

echo '    X' | sed ':a; p; s/ //; ta; d'
# :a はラベル
# ta は前の命令(s/ //)が成功したらラベルaに戻る
# p はプリントする 
# s/ // は空白を一つ削除
# d は残った文字列を削除

echo '    X' | awk '{print;while(sub(/ /,"",$0))print}'
# sub関数は変換した文字を返す
# ここでは 文字全体に対して空白を一つ削除する
# 成功すると1を返す
# 成功し続ける限りループを繰り返す

```

## P46 問題7 消費税

```bash
FILE_PATH='../shellgei160/qdata/7/kakeibo.txt'

# 消費税率を4列目に追加
cat $FILE_PATH | awk '{print $0, 1.1}'
# 20190901 ゼロカップ大関 10000 1.1
# 20190902 *キャベツ二郎 130 1.1
# 20191105 外食 13000 1.1
# 20191106 ストロングワン 13000 1.1
# 20191106 *ねるねるねるねる 30 1.1
# 20190912 外食 13000 1.1

# 2019/10/1 以前、または * が付いているものは1.08、それ以外は 1.1にする
cat $FILE_PATH | awk '{tax=($1<"20191001" || $2~"^*") ? 1.08 : 1.1; print $0,tax}'
# 20190901 ゼロカップ大関 10000 1.08
# 20190902 *キャベツ二郎 130 1.08
# 20191105 外食 13000 1.1
# 20191106 ストロングワン 13000 1.1
# 20191106 *ねるねるねるねる 30 1.08
# 20190912 外食 13000 1.08

# それぞれ掛け合わせる
cat $FILE_PATH | awk '{tax=($1<"20191001" || $2~"^*") ? 1.08 : 1.1; print $0,tax}' | awk '{print int($3*$4)}'
# 10800
# 140
# 14300
# 14300
# 32
# 14040

# 合計を出す
# numsum は入力された数値の合計値を出す
cat $FILE_PATH | awk '{tax=($1<"20191001" || $2~"^*") ? 1.08 : 1.1; print $0,tax}' | awk '{print int($3*$4)}' | numsum
# 53612

```