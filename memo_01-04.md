# 第1章Linux環境 1.1～1.4 ファイルを操作する

## P34 問題1 ファイル名の検索

exeファイルのみ抽出

```bash
FILE_PATH='../shellgei160/qdata/1/files.txt'
cat ${FILE_PATH}
# test.txt
# test.exe
# 画面仕様書_v2.0.xls
# 画面仕様書.xls.exe
# secret file.md
# 画面仕様書_改訂版.xlsx
# 画面仕様書_最新バージョン.xls
# README.md
# 秘密のファイル.exe.jpeg
# LICENSE
# execution.sh
# packman_exe
# 重要書類.doc

cat ${FILE_PATH} | grep "\.exe$"
# test.exe
# 画面仕様書.xls.exe
```

別解

```bash
# -n は各行を自動的に出力しないというオプション
# p 行を単に出力する。通常は -n オプションと組み合わせる。
# sedコマンドでは処理結果をデフォルトで出力するが、-n オプションを付けるとデフォルトの出力がされなくなり、pコマンドの出力のみになる。
# https://hydrocul.github.io/wiki/commands/sed.html
cat ${FILE_PATH} | sed -n '/\.exe$/p'
```

```bash
# / / で囲んでいる文字列を抽出する
cat ${FILE_PATH} | awk '/\.exe$/'
```

```bash
cat ${FILE_PATH} | perl -ne '/\.exe$/ and print'
```

## P35 問題2 画像ファイルの一括返還

ImageMagickのインストール
```bash
sudo apt update
sudo apt install imagemagick
```

```bash
DIR_PATH='../shellgei160/qdata/2/img'
# cp -r ${DIR_PATH} ${DIR_PATH}.bk コピーは不要だった

# sed で拡張子を削除
# xargs -I@ で　@ にファイル名(拡張子以外)をセット 
ls ${DIR_PATH}/*.png | sed 's/\.png//' | xargs -I@ convert @.png @.jpg

# 処理時間を計測するには time をつける
time ls ${DIR_PATH}/*.png | sed 's/\.png//' | xargs -I@ convert @.png @.jpg
# real    0m0.926s
# user    0m0.967s
# sys     0m0.208s

# xargs -P4 とするとコマンドを4個平行実行する
time ls ${DIR_PATH}/*.png | sed 's/\.png//' | xargs -P4 -I@ convert @.png @.jpg
# real    0m0.343s
# user    0m1.516s
# sys     0m0.341s

# nproc を使うと平行で走らせられる処理の数を調べられる
nproc
# 8
# 最大数を指定しても4とそこまで変わらない
time ls ${DIR_PATH}/*.png | sed 's/\.png//' | xargs -P$(nproc) -I@ convert @.png @.jpg
# real    0m0.346s
# user    0m2.161s
# sys     0m0.478s
```

別解 ImageMagickにあるmogrifyコマンドを使う。xargsなしでファイルを一括処理できる

```bash
mogrify -format jpg ${DIR_PATH}/*.png
# そこまで速くない
# real    0m0.615s
# user    0m1.104s
# sys     0m0.013s
```
